## neovim
alias vim="nvim"
alias vi="nvim"
alias vimdiff="nvim -d"
export EDITOR=/usr/homebrew/bin/nvim

## lsd
alias la="lsd -al --no-symlink"
alias ls="lsd --no-symlink"
alias ll="lsd -l --no-symlink"
alias lt="lsd --tree --no-symlink"

## docker
alias da="docker ps -a"
alias di="docker images"
alias dri="docker rmi "
alias du="docker compose up -d"
alias dd="docker compose down"
alias dp="docker system prune -a"
function de {
  docker exec -it "$1" "${@:2}"
}

## zsh plugin
source $(brew --prefix)/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
source $(brew --prefix)/share/zsh-autosuggestions/zsh-autosuggestions.zsh

# z
. $HOMEBREW_PREFIX/etc/profile.d/z.sh

## common
alias rr="rm -rf "
function mc {
	mkdir -p $1
	cd $1
}
alias ip="curl -s http://checkip.dyndns.org/ | sed 's/[a-zA-Z<>/ :]//g'"

## git
function w() { git switch "$@" } # ë¸Œëœì¹˜ ì´ë™
function su() { git stash save -u "$@" } # Stash ì €ì¥
function sc() { git switch -c "$@" } # ë¸Œëœì¹˜ ìƒì„±í•˜ë©´ì„œ ì´ë™
function f() { git fetch origin "$@" } # git fetch
function fp() { git push -f origin "$@" } # git force push
function p() { git push origin "$@" } # git push
function pu() { git pull origin "$@" } # git pull
function bd() { git branch -D "$@" } # git branch ì‚­ì œ
function spn() { git stash pop stash@{$@} } # git stash ì œê±°í•˜ë©´ì„œ ì ìš©
function sa() { git stash apply stash@{$@} } # git stash ì ìš©ë§Œ stashëŠ” ìœ ì§€
function sd() { git stash drop stash@{$@} } # git stash ì‚­ì œ

# git commit "ì œëª©""ë³¸ë¬¸"
function c() {
  if [ -z "$1" ]; then
    echo "ì˜¤ë¥˜: ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."
    echo "ì‚¬ìš©ë²•: c \"ì œëª©\" \"ë³¸ë¬¸(ì„ íƒ)\""
    return 1
  fi

  if [ -z "$2" ]; then
    # ë³¸ë¬¸ì´ ì—†ëŠ” ê²½ìš° ì œëª©ë§Œ ì»¤ë°‹
    git commit -m "$1"
  else
    # ì œëª©ê³¼ ë³¸ë¬¸ì„ ë‚˜ëˆ„ì–´ ì»¤ë°‹
    git commit -m "$1" -m "$2"
  fi
}

# ì›Œí¬íŠ¸ë¦¬ ë¦¬ìŠ¤íŠ¸
function wl() {
  git worktree list
}

# ===== Git Worktree í•¨ìˆ˜ë“¤ =====

# ì›Œí¬íŠ¸ë¦¬ ëª©ë¡ ë³´ê¸° (ë³´ê¸° ì¢‹ê²Œ)
function wl() {
  git worktree list
}

# ì›Œí¬íŠ¸ë¦¬ ì¶”ê°€ (ë¸Œëœì¹˜ ìˆìœ¼ë©´ ì²´í¬ì•„ì›ƒ, ì—†ìœ¼ë©´ ìƒì„±)
function wa() {
  local create=false
  
  while getopts "c" opt; do
    case $opt in
      c) create=true ;;
    esac
  done
  shift $((OPTIND - 1))
  
  if [ -z "$1" ]; then
    echo "ì‚¬ìš©ë²•: wa [-c] [í´ë”prefix/]<ë¸Œëœì¹˜ëª…>"
    return 1
  fi
  
  local input="${1#origin/}"
  # ë§ˆì§€ë§‰ ìŠ¬ë˜ì‹œ ê¸°ì¤€ìœ¼ë¡œ prefixì™€ ë¸Œëœì¹˜ëª… ë¶„ë¦¬
  local branch="${input##*/}"
  local prefix=""
  if [[ "$input" == */* ]]; then
    prefix="${input%/*}/"
  fi
  
  local base="../${PWD##*/}"
  local dir="${base}-${prefix}${branch}"
  
  if $create; then
    mkdir -p "$(dirname "$dir")"
    git worktree add -b "$branch" "$dir" && cd "$dir"
  else
    git fetch origin "$branch" && \
    mkdir -p "$(dirname "$dir")"
    git worktree add --track -b "$branch" "$dir" "origin/$branch" && \
    cd "$dir"
  fi
}

# ì›Œí¬íŠ¸ë¦¬ + ë¸Œëœì¹˜ ì‚­ì œ
function wr() {
  if [ -z "$1" ]; then
    echo "ì‚¬ìš©ë²•: wr <ì›Œí¬íŠ¸ë¦¬ëª…>"
    return 1
  fi
  
  local name=$1
  local main_dir=$(git worktree list | head -1 | awk '{print $1}')
  local base=$(basename "$main_dir")
  local dir="$(dirname "$main_dir")/${base}-$name"
  
  git worktree remove "$dir" 2>/dev/null || git worktree remove --force "$dir"
  
  # ë¸Œëœì¹˜ ì‚­ì œ ì‹œë„ - ì‹¤íŒ¨í•˜ë©´ ì•ì—ì„œë¶€í„° / ì œê±°í•˜ë©° ì¬ì‹œë„
  local branch="$name"
  while true; do
    if git branch -D "$branch" 2>/dev/null; then
      echo "ë¸Œëœì¹˜ '$branch' ì‚­ì œë¨"
      return 0
    fi
    
    if [[ "$branch" != */* ]]; then
      echo "error: ë¸Œëœì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: $name"
      return 1
    fi
    
    branch="${branch#*/}"
  done
}

# ì›Œí¬íŠ¸ë¦¬ë¡œ ì´ë™ (fzf í•„ìš”)
function wc() {
  local selected=$(git worktree list | fzf --height 40% | awk '{print $1}')
  if [ -n "$selected" ]; then
    cd "$selected"
  fi
}

# ì›Œí¬íŠ¸ë¦¬ ì •ë¦¬ (ì‚­ì œëœ ë””ë ‰í† ë¦¬ ì •ë³´ ì œê±°)
function wp() {
  git worktree prune -v
}

# í˜„ì¬ ì›Œí¬íŠ¸ë¦¬ ì •ë³´
function wi() {
  echo "ğŸ“ í˜„ì¬ ìœ„ì¹˜: $(pwd)"
  echo "ğŸŒ¿ ë¸Œëœì¹˜: $(git branch --show-current)"
  echo ""
  echo "ğŸ“‹ ì „ì²´ ì›Œí¬íŠ¸ë¦¬:"
  git worktree list
}

alias sp="git stash pop"
alias sl="git stash list"
alias st="git overview" # ì‚¬ìš©í•˜ë ¤ë©´ brew install git-delta
alias ba="git branch -a"
alias df="git df"
alias fo="git fo"

## completions
_git_branch_completion() {
    local -a branches
    branches=(${(f)"$(git branch -a --format='%(refname:short)')"})
    compadd -M 'm:{[:lower:][:upper:]}={[:upper:][:lower:]} l:|=* r:|=*' "$@" $branches
}

_git_worktree_completion() {
    local main_dir=$(git worktree list | head -1 | awk '{print $1}')
    local base=$(basename "$main_dir")
    local parent=$(dirname "$main_dir")
    local -a names
    names=(${(f)"$(git worktree list --porcelain | grep '^worktree ' | sed 's/^worktree //' | while read dir; do
        echo "${dir#$parent/$base-}"
    done | tail -n +2)"})
    compadd -M 'm:{[:lower:][:upper:]}={[:upper:][:lower:]} l:|=* r:|=*' "$@" $names
}

compdef _git_branch_completion w
compdef _git_branch_completion f
compdef _git_branch_completion fp
compdef _git_branch_completion p
compdef _git_branch_completion pu
compdef _git_branch_completion bd
compdef _git_branch_completion wa
compdef _git_worktree_completion wr

## tmux
alias tm="tmux new -s "
alias tl="tmux ls"
alias tk="tmux kill-server"
alias ta="tmux a -t "
alias td="tmux detach"

## gradle setting
alias gk="./gradlew ktlintFormat"
alias xx="./gradlew clean test --info --console=rich --stacktrace --fail-fast"

## homebrew
export EDITOR=/usr/homebrew/bin/nvim

## powerlevel10k
source /opt/homebrew/share/powerlevel10k/powerlevel10k.zsh-theme

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

#THIS MUST BE AT THE END OF THE FILE FOR SDKMAN TO WORK!!!
export SDKMAN_DIR="$HOME/.sdkman"
[[ -s "$HOME/.sdkman/bin/sdkman-init.sh" ]] && source "$HOME/.sdkman/bin/sdkman-init.sh"

